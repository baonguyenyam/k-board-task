"use strict";function reFresh(e){$('[data-step="step-'+e+'"]').html("Loading..."),setTimeout(function(){1==e?__index__getData("step-1","P"):2==e?__index__getData("step-2","I"):__index__getData("step-3","D")},1e3)}function __index__getData(l,s){$.ajax({url:Global.API_URL+"/tasks.json",type:"GET",dataType:"json",cache:!0,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("Token"))},complete:function(e){App.Data=e.responseJSON;var t=[];for(var a in App.Data)if(App.Data.hasOwnProperty(a)&&App.Data[a]){var n=App.Data[a].State,i=App.Data[a];n===s&&t.push(App.__template(i.ObjectId,i.MetaIndex,i.Name,i.CreatedDate,i.MetaDescription,i.MetaTextValue,getUserName(i.CreateID),getUserName(i.workID),i.ActivatedTS,i.Project,i.Material,i.Est))}if((Settings.OneWay||"true"===Settings.OneWay)&&"step-1"===l){var o=1;$('[data-step="'+l+'"]').find("li").each(function(){o<=Settings.ActiveNumberStep1Drag||$(this).addClass("disabled"),o++})}$('[data-step="'+l+'"]').html(t),$('[data-toggle="tooltip"]').tooltip(),__main__callAction()},error:function(e,t,a){}})}function getUserName(e){var n=e;return $.ajax({url:Global.API_URL+"/user.json?id="+n,type:"GET",async:!0,dataType:"json",cache:!0,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("Token"))},error:function(e,t,a){},complete:function(e){var t=JSON.parse(e.responseText);for(var a in t)if(t.hasOwnProperty(a)){t[a].ObjectId;parseInt(a)==n&&(t=t[a])}checkNull(t.fullname)}})}function __index__updateTask(e,t){var a="";a="step-1"===t?"P":"step-2"===t?"I":"D",$.ajax({url:"/update",type:"POST",dataType:"json",cache:!0,data:{id:e,status:a},complete:function(e){e.responseJSON}})}function __index__sortAble(){$("#k-board-task .sortable[data-step='step-1']").sortable({connectWith:Settings.OneWay&&"false"!==Settings.OneWay?"#k-board-task .sortable[data-step='step-2']":".connectedSortable",items:"li:not(.disabled)",placeholder:"ui-highlight",start:function(e,t){t.placeholder.height(t.item.outerHeight()),t.placeholder.html(t.item.html()),t.placeholder.addClass("list-group-item list-group-item-action")},update:function(e,t){__main__checkContent()},receive:function(e,t){__index__updateTask(t.item.attr("id"),$(e.target).attr("data-step"))}}).disableSelection(),$("#k-board-task .sortable[data-step='step-2']").sortable({connectWith:Settings.OneWay&&"false"!==Settings.OneWay?"#k-board-task .sortable[data-step='step-3']":".connectedSortable",items:"li:not(.disabled)",placeholder:"ui-highlight",start:function(e,t){t.placeholder.height(t.item.outerHeight()),t.placeholder.html(t.item.html()),t.placeholder.addClass("list-group-item list-group-item-action")},update:function(e,t){__main__checkContent()},receive:function(e,t){$(this).children().length>Settings.ActiveNumberStep2Drop?$(t.sender).sortable("cancel"):(__index__updateTask(t.item.attr("id"),$(e.target).attr("data-step")),(Settings.OneWay||"true"===Settings.OneWay)&&reFresh(1))}}).disableSelection(),$("#k-board-task .sortable[data-step='step-3']").sortable({connectWith:Settings.OneWay&&"false"!==Settings.OneWay?"":".connectedSortable",items:"li:not(.disabled)",placeholder:"ui-highlight",start:function(e,t){t.placeholder.height(t.item.outerHeight()),t.placeholder.html(t.item.html()),t.placeholder.addClass("list-group-item list-group-item-action")},update:function(e,t){__main__checkContent()},receive:function(e,t){__index__updateTask(t.item.attr("id"),$(e.target).attr("data-step")),(Settings.OneWay||"true"===Settings.OneWay)&&reFresh(2)}}).disableSelection(),Settings.ActiveDashboard&&"false"!==Settings.ActiveDashboard||$(".connectedSortable").sortable("disable")}function __index__onResize(){setTimeout(function(){var e=$("#pdfModal .modal-body").height();$("#pdfModal .modal-body iframe").css({height:e+"px"}),$("#pdfModal .modal-body").css({height:e+"px"}),initIframe()},1e3)}localStorage.getItem("Token")&&0<localStorage.getItem("Token").length||(window.location.href="/login"),console.log(getUserName(1)),$(document).ready(function(){__index__getData("step-1","P"),__index__getData("step-2","I"),__index__getData("step-3","D"),__index__sortAble(),__main__addForm()}),$(window).resize(function(){__index__onResize()}),$(function(){$.contextMenu.types.label=function(e,t,a){$('<span>Độ ưu tiên<ul><li class="label1" title="label 1">label 1</li><li class="label2" title="label 2">label 2</li><li class="label3" title="label 3">label 3</li><li class="label4" title="label 4">label 4</li></ul></span>').appendTo(this).on("click","li",function(){console.log("Clicked on "+$(this).text()),a.$menu.trigger("contextmenu:hide")}),this.addClass("labels").on("contextmenu:focus",function(e){}).on("contextmenu:blur",function(e){}).on("keydown",function(e){})},$.contextMenu({selector:".list-group-item-action",callback:function(e,t,a,n){var i=$(this),o=$(this).attr("id");if(!confirm("Bạn có chắc chắn xóa task này?"))return!1;$.ajax({url:"/delete",type:"POST",async:!0,dataType:"json",cache:!0,data:{id:o},contentType:"application/json; charset=utf-8",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("Token"))},complete:function(e){$(i).remove()}})},items:{open:{name:"Xem chi tiết",icon:"edit",callback:function(e,t,a,n){var i=$(this).attr("id");window.location.href="/gettask?id="+i}},sep1:"---------",label:{type:"label",customName:"Label",callback:$.noop},sep2:"---------",delete:{name:"Xóa",icon:"delete"}}})});