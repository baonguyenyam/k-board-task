"use strict";function reFresh(t){$('[data-step="step-'+t+'"]').html("Đang tải..."),setTimeout(function(){1==t?__index__getData("step-1","P"):2==t?__index__getData("step-2","I"):__index__getData("step-3","D")},1e3)}function __index__getData(l,s){$.ajax({url:Global.API_URL+"/tasks.json",type:"GET",dataType:"json",cache:!0,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+localStorage.getItem("Token"))},complete:function(t){App.Data=t.responseJSON;var e=[];for(var a in App.Data)if(App.Data.hasOwnProperty(a)&&App.Data[a]){var i=App.Data[a].State,n=App.Data[a];i===s&&e.push(App.__template(n.ObjectId,n.MetaIndex,n.Name,n.CreatedDate,n.MetaDescription,n.MetaTextValue,n.CreateID,n.workID,n.ActivatedTS,n.Project,n.Est,n.Material))}if((Settings.OneWay||"true"===Settings.OneWay)&&"step-1"===l){var o=1;$('[data-step="'+l+'"]').find("li").each(function(){o<=Settings.ActiveNumberStep1Drag||$(this).addClass("disabled"),o++})}$('[data-step="'+l+'"]').html(e),$('[data-toggle="tooltip"]').tooltip(),__main__callAction()},error:function(t,e,a){}})}function __index__updateTask(t,e){var a="";a="step-1"===e?"P":"step-2"===e?"I":"D",$.ajax({url:"/update",type:"POST",dataType:"json",cache:!0,data:{id:t,State:a},complete:function(t){t.responseJSON}})}function __index__sortAble(){$("#k-board-task .sortable[data-step='step-1']").sortable({connectWith:Settings.OneWay&&"false"!==Settings.OneWay?"#k-board-task .sortable[data-step='step-2']":".connectedSortable",items:"li:not(.disabled)",placeholder:"ui-highlight",start:function(t,e){e.placeholder.height(e.item.outerHeight()),e.placeholder.html(e.item.html()),e.placeholder.addClass("list-group-item list-group-item-action")},update:function(t,e){__main__checkContent()},receive:function(t,e){__index__updateTask(e.item.attr("id"),$(t.target).attr("data-step"))}}).disableSelection(),$("#k-board-task .sortable[data-step='step-2']").sortable({connectWith:Settings.OneWay&&"false"!==Settings.OneWay?"#k-board-task .sortable[data-step='step-3']":".connectedSortable",items:"li:not(.disabled)",placeholder:"ui-highlight",start:function(t,e){e.placeholder.height(e.item.outerHeight()),e.placeholder.html(e.item.html()),e.placeholder.addClass("list-group-item list-group-item-action")},update:function(t,e){__main__checkContent()},receive:function(t,e){$(this).children().length>Settings.ActiveNumberStep2Drop?$(e.sender).sortable("cancel"):(__index__updateTask(e.item.attr("id"),$(t.target).attr("data-step")),(Settings.OneWay||"true"===Settings.OneWay)&&reFresh(1))}}).disableSelection(),$("#k-board-task .sortable[data-step='step-3']").sortable({connectWith:Settings.OneWay&&"false"!==Settings.OneWay?"":".connectedSortable",items:"li:not(.disabled)",placeholder:"ui-highlight",start:function(t,e){e.placeholder.height(e.item.outerHeight()),e.placeholder.html(e.item.html()),e.placeholder.addClass("list-group-item list-group-item-action")},update:function(t,e){__main__checkContent()},receive:function(t,e){__index__updateTask(e.item.attr("id"),$(t.target).attr("data-step")),(Settings.OneWay||"true"===Settings.OneWay)&&reFresh(2)}}).disableSelection(),Settings.Permission.ActiveDashboard&&"false"!==Settings.Permission.ActiveDashboard||$(".connectedSortable").sortable("disable")}function __index__onResize(){setTimeout(function(){var t=$("#pdfModal .modal-body").height();$("#pdfModal .modal-body iframe").css({height:t+"px"}),$("#pdfModal .modal-body").css({height:t+"px"}),initIframe()},1e3)}$(document).ready(function(){__index__getData("step-1","P"),__index__getData("step-2","I"),__index__getData("step-3","D"),__index__sortAble(),__main__addForm()}),$(window).resize(function(){__index__onResize()}),$(function(){$.contextMenu.types.label=function(t,e,a){$('<span>Độ ưu tiên<ul><li class="label1" title="label 1">Thấp</li><li class="label2" title="label 2">Bình thường</li><li class="label3" title="label 3">Trung bình</li><li class="label4" title="label 4">Cao</li></ul></span>').appendTo(this).on("click","li",function(){console.log("Clicked on "+$(this).text()),a.$menu.trigger("contextmenu:hide")}),this.addClass("labels").on("contextmenu:focus",function(t){}).on("contextmenu:blur",function(t){}).on("keydown",function(t){})},$.contextMenu({selector:".list-group-item-action",callback:function(t,e,a,i){var n=$(this),o=$(this).attr("id");if(!confirm("Bạn có chắc chắn xóa task này?"))return!1;$.ajax({url:"/delete",type:"POST",async:!0,dataType:"json",cache:!0,data:{id:o},contentType:"application/json; charset=utf-8",beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+localStorage.getItem("Token"))},complete:function(t){$(n).remove()}})},items:"true"===localStorage.getItem("permision_modifytask")?{open:{name:"Xem chi tiết",icon:"edit",callback:function(t,e,a,i){var n=$(this).attr("id");window.location.href="/gettask?id="+n}},sep1:"---------",label:{type:"label",customName:"Label",callback:$.noop},sep2:"---------",delete:{name:"Xóa",icon:"delete"}}:{open:{name:"Xem chi tiết",icon:"edit",callback:function(t,e,a,i){var n=$(this).attr("id");window.location.href="/gettask?id="+n}}}})});