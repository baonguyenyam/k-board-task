"use strict";function reFresh(t){$('[data-step="step-'+t+'"]').addClass("on-load"),setTimeout(function(){1==t?__index__getData("step-1","P"):2==t?__index__getData("step-2","I"):__index__getData("step-3","D"),$('[data-step="step-'+t+'"]').removeClass("on-load")},1e3),toastrMsg("Cập nhật danh sách hoàn tất","Cập nhật",2e3)}function __index__getData(r,d){$.ajax({url:Global.API_URL+"/tasks.json",type:"GET",dataType:"json",cache:!0,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+localStorage.getItem("Token"))},complete:function(t){App.Data=t.responseJSON;var e=App.Data.filter(function(t){return t.State===d});e.sort(function(t,e){var a=new Date(t.CreatedDate);return new Date(e.CreatedDate)-a}),e.sort(function(t,e){return new Date(t.order)-new Date(e.order)});var a=[];for(var n in e)if(e.hasOwnProperty(n)&&e[n]){var i=e[n].State,o=e[n];i===d&&a.push(App.__template(o.ObjectId,o.MetaIndex,o.Name,o.CreatedDate,o.MetaDescription,o.MetaTextValue,o.CreateID,o.workID,o.ActivatedTS,o.Project,o.Est,o.Material,o.order,o.ObjectType))}if($('[data-step="'+r+'"]').html(a),Settings.OneWay&&"true"===Settings.OneWay&&"step-1"===r){var s=1;$('[data-step="'+r+'"]').find("li").each(function(){s<=Settings.ActiveNumberStep1Drag||$(this).addClass("disabled"),s++})}$('[data-toggle="tooltip"]').tooltip(),__main__callAction(),__main__checkContent()},error:function(t,e,a){}})}function __index__updateTask(t,e){var a="";a="step-1"===e?"P":"step-2"===e?"I":"D",$.ajax({url:"/update",type:"POST",dataType:"json",cache:!0,data:{id:t,State:a},complete:function(t){t.responseJSON}})}function __index__sortAble(){$("#k-board-task .sortable[data-step='step-1']").sortable({connectWith:Settings.OneWay&&"false"!==Settings.OneWay?"#k-board-task .sortable[data-step='step-2']":".connectedSortable",items:"li:not(.disabled)",placeholder:"ui-highlight",start:function(t,e){e.placeholder.height(e.item.outerHeight()),e.placeholder.html(e.item.html()),e.placeholder.addClass("list-group-item list-group-item-action"),__main__checkContent()},update:function(t,e){__main__checkContent(),__main__updateOrder($(t.target).attr("data-step"))},receive:function(t,e){__index__updateTask(e.item.attr("id"),$(t.target).attr("data-step")),__main__checkContent(),__main__updateOrder($(t.target).attr("data-step"))},stop:function(t,e){toastrMsg("Cập nhật danh sách hoàn tất","Cập nhật",2e3)}}).disableSelection(),$("#k-board-task .sortable[data-step='step-2']").sortable({connectWith:Settings.OneWay&&"false"!==Settings.OneWay?"#k-board-task .sortable[data-step='step-3']":".connectedSortable",items:"li:not(.disabled)",placeholder:"ui-highlight",start:function(t,e){e.placeholder.height(e.item.outerHeight()),e.placeholder.html(e.item.html()),e.placeholder.addClass("list-group-item list-group-item-action"),__main__checkContent()},update:function(t,e){__main__checkContent(),__main__updateOrder($(t.target).attr("data-step"))},receive:function(t,e){$(this).children().length>Settings.ActiveNumberStep2Drop?$(e.sender).sortable("cancel"):(__index__updateTask(e.item.attr("id"),$(t.target).attr("data-step")),(Settings.OneWay||"true"===Settings.OneWay)&&reFresh(1)),__main__checkContent(),__main__updateOrder($(t.target).attr("data-step"))},stop:function(t,e){toastrMsg("Cập nhật danh sách hoàn tất","Cập nhật",2e3)}}).disableSelection(),$("#k-board-task .sortable[data-step='step-3']").sortable({connectWith:Settings.OneWay&&"false"!==Settings.OneWay?"":".connectedSortable",items:"li:not(.disabled)",placeholder:"ui-highlight",start:function(t,e){e.placeholder.height(e.item.outerHeight()),e.placeholder.html(e.item.html()),e.placeholder.addClass("list-group-item list-group-item-action"),__main__checkContent()},update:function(t,e){__main__checkContent(),__main__updateOrder($(t.target).attr("data-step"))},receive:function(t,e){__index__updateTask(e.item.attr("id"),$(t.target).attr("data-step")),(Settings.OneWay||"true"===Settings.OneWay)&&reFresh(2),__main__checkContent(),__main__updateOrder($(t.target).attr("data-step"))},stop:function(t,e){toastrMsg("Cập nhật danh sách hoàn tất","Cập nhật",2e3)}}).disableSelection(),Settings.Permission.ActiveDashboard&&"false"!==Settings.Permission.ActiveDashboard||$(".connectedSortable").sortable("disable")}function __index__onResize(){setTimeout(function(){var t=$("#pdfModal .modal-body").height();$("#pdfModal .modal-body iframe").css({height:t+"px"}),$("#pdfModal .modal-body").css({height:t+"px"}),initIframe()},1e3)}$(document).ready(function(){__index__getData("step-1","P"),__index__getData("step-2","I"),__index__getData("step-3","D"),__index__sortAble(),__main__addForm()}),$(window).resize(function(){__index__onResize()}),$(function(){$.contextMenu.types.label=function(t,e,a){$('<span>Độ ưu tiên<ul><li class="label1" data-val="0">Thấp</li><li class="label2" data-val="1">Bình thường</li><li class="label3" data-val="2">Trung bình</li><li class="label4" data-val="3">Cao</li></ul></span>').appendTo(this).on("click","li",function(){var e=$(a.$trigger[0]).parents(".list-group").attr("data-step");$.ajax({url:"/modify",type:"POST",dataType:"json",cache:!0,data:{id:$(a.$trigger[0]).attr("id"),MetaIndex:$(this).attr("data-val")},complete:function(t){reFresh("step-1"===e?1:"step-2"===e?2:3)}}),a.$menu.trigger("contextmenu:hide")}),this.addClass("labels").on("contextmenu:focus",function(t){}).on("contextmenu:blur",function(t){}).on("keydown",function(t){})},$.contextMenu({selector:".list-group-item-action",callback:function(t,e,a,n){var i=$(this),o=$(this).attr("id");if(!confirm("Bạn có chắc chắn xóa task này?"))return!1;$.ajax({url:"/delete",type:"POST",dataType:"json",cache:!0,data:{id:o},beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+localStorage.getItem("Token"))},complete:function(t){$(i).remove()}})},items:"true"===localStorage.getItem("permision_modifytask")?{open:{name:"Xem chi tiết",icon:"edit",callback:function(t,e,a,n){var i=$(this).attr("id");window.location.href="/gettask?id="+i}},sep1:"---------",label:{type:"label",customName:"Label",callback:$.noop},sep2:"---------",delete:{name:"Xóa",icon:"delete"}}:{open:{name:"Xem chi tiết",icon:"edit",callback:function(t,e,a,n){var i=$(this).attr("id");window.location.href="/gettask?id="+i}}}})});