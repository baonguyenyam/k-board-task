"use strict";function reFresh(e){$('[data-step="step-'+e+'"]').html("Loading..."),setTimeout(function(){1==e?__index__getData("step-1","P"):2==e?__index__getData("step-2","I"):__index__getData("step-3","D")},1e3)}function __index__getData(l,c){$.ajax({url:Global.API_URL+"/etracking/cnctask/getjobs?withState=true",type:"GET",dataType:"json",cache:!0,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("Token"))},complete:function(e){App.Data=e.responseJSON;var t=[];for(var a in App.Data)if(App.Data.hasOwnProperty(a)&&App.Data[a].Properties.JobStates){varsame=App.Data[a].Properties.JobStates[0].State;var o=App.Data[a].Properties.JobStates[0],n=App.Data[a].Properties.JobDetail,i=App.Data[a];varsame===c&&t.push(App.__template(i.ObjectId,i.MetaIndex,i.Name,i.CreatedDate,i.MetaDescription,i.MetaTextValue,i.Owner.FullName,o.Activator.FullName,o.ActivatedTS,n.Project,n.Material,n.PaintColor))}$('[data-step="'+l+'"]').html(t),$('[data-toggle="tooltip"]').tooltip(),__index__callAction()},error:function(e,t,a){}})}function __index__updateTask(e,t){var a="";a="step-1"===t?"P":"step-2"===t?"I":"D",$.ajax({url:Global.API_URL+"/etracking/cnctask/setstate?jobid="+e+"&newState="+a+"&returnAllStates=true",type:"POST",dataType:"json",cache:!0,complete:function(e){e.responseJSON}})}function __index__callAction(){$("#k-board-task .sortable .pdf").each(function(){$(this).click(function(){var e=$(this).parents(".content").find("h3").html(),t=$(this).attr("data-files");$("#pdfModal .modal-title").html(e),$("#pdfModal .modal-body").html("<iframe></iframe>"),$("#pdfModal .modal-body iframe").attr("src",Global.URLPath+"/pdfjs/web/viewer.html?files=/files/"+t),setTimeout(function(){var e=$("#pdfModal .modal-body").height();$("#pdfModal .modal-body iframe").css({height:e+"px"}),$("#pdfModal .modal-body").css({height:e+"px"})},1e3)})})}function initIframe(){$("#pdfModal .modal-body iframe").contents().find("#viewerContainer .page:first-child .canvasWrapper").append('<div class="hidebarcode"></div>')}function __index__sortAble(){$("#k-board-task .sortable").sortable({connectWith:".connectedSortable",placeholder:"ui-highlight",start:function(e,t){t.placeholder.height(t.item.outerHeight()),t.placeholder.html(t.item.html()),t.placeholder.addClass("list-group-item list-group-item-action")},update:function(e,t){__index__checkContent()},receive:function(e,t){__index__updateTask(t.item.attr("id"),$(e.target).attr("data-step"))}}).disableSelection()}function __index__addForm(){__index__checkContent(),$("#pdfModal").on("hidden.bs.modal",function(e){$("#pdfModal .modal-body").html("Đang tải...")}),$("#activecode").click(function(){$("#pdfModal .modal-body iframe").contents().find("#viewerContainer .canvasWrapper .hidebarcode").remove()})}function __index__checkContent(){$("#k-board-task .sortable").each(function(){0<$(this).html().length?$(this).removeClass("active"):$(this).addClass("active")})}function __index__onResize(){setTimeout(function(){var e=$("#pdfModal .modal-body").height();$("#pdfModal .modal-body iframe").css({height:e+"px"}),$("#pdfModal .modal-body").css({height:e+"px"}),initIframe()},1e3)}localStorage.getItem("Token")&&0<localStorage.getItem("Token").length||(window.location.href="/login"),$(document).ready(function(){__index__getData("step-1","P"),__index__getData("step-2","I"),__index__getData("step-3","D"),__index__sortAble(),__index__addForm()}),$(window).resize(function(){__index__onResize()}),$(function(){$.contextMenu.types.label=function(e,t,a){$('<span>Độ ưu tiên<ul><li class="label1" title="label 1">label 1</li><li class="label2" title="label 2">label 2</li><li class="label3" title="label 3">label 3</li><li class="label4" title="label 4">label 4</li></ul></span>').appendTo(this).on("click","li",function(){console.log("Clicked on "+$(this).text()),a.$menu.trigger("contextmenu:hide")}),this.addClass("labels").on("contextmenu:focus",function(e){}).on("contextmenu:blur",function(e){}).on("keydown",function(e){})},$.contextMenu({selector:".list-group-item-action",callback:function(e,t,a,o){var n=$(this),i=$(this).attr("id");if(!confirm("Bạn có chắc chắn xóa task này?"))return!1;$.ajax({url:Global.API_URL+"/etracking/cnctask/setstate?jobid="+i+"&newState=N&returnAllStates=true",type:"POST",async:!0,dataType:"json",cache:!0,contentType:"application/json; charset=utf-8",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+localStorage.getItem("Token"))},complete:function(e){$(n).remove()}})},items:{open:{name:"Xem chi tiết",icon:"edit",callback:function(e,t,a,o){var n=$(this).attr("id");window.location.href="/gettask?id="+n}},sep1:"---------",label:{type:"label",customName:"Label",callback:$.noop},sep2:"---------",delete:{name:"Xóa",icon:"delete"}}})});