"use strict";function __addTask_submitForm(){$("#datepicker").datetimepicker({controlType:"select",oneLine:!0,dateFormat:"yy-mm-dd",timeFormat:"HH:mm"}),$("#customFile").on("change paste keyup",function(t){var e=t.target.files[0].name;$("#customFileLabel").html(e)}),$("form.validator").validator().on("submit",function(t){return t.isDefaultPrevented()?alert("Vui lòng kiểm tra lại thông tin"):(App.txtNewTitle=$("#text").val(),App.txtNewSelect=$("#select").val(),App.txtNewMesage=$("#message").val(),App.txtNewDate=$("#datepicker").val(),App.txtNewProject=$("#namepro").val(),App.txtNewColor=$("#color").val(),App.txtNewMaterial=$("#material").val(),upLoadPDF(App.txtNewTitle,App.txtNewSelect,App.txtNewMesage,App.txtNewDate,App.txtNewProject,App.txtNewColor,App.txtNewMaterial)),!1})}function __addTask_createTask(t,e,a,o,r,n,s,l){var i=moment(Date.now()).format("YYYY-MM-DD")+" "+moment(Date.now()).format("HH:mm"),p=JSON.stringify({ObjectType:"k.task",ObjectId:md5(t),MetaIndex:parseInt(e),Name:t,order:0,CreatedDate:i,MetaDescription:a,MetaTextValue:r,CreateID:parseInt(localStorage.getItem("CurrentUserID")),workID:parseInt(App.workID),State:"P",ActivatedTS:o,Project:n,Material:l,Est:s});$.ajax({url:"/save",type:"POST",async:!0,dataType:"json",cache:!0,data:p,contentType:"application/json; charset=utf-8",beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+localStorage.getItem("Token"))},error:function(t,e,a){},complete:function(t){}})}function upLoadPDF(e,a,o,r,n,s,l){var t=new FormData($("#addtask")[0]);return $.ajax({url:"/upload",type:"POST",contentType:!1,processData:!1,cache:!1,data:t,success:function(t){"error"===t.toString()?alert("Chỉ hỗ trợ tập tin PDF"):(__addTask_createTask(e,a,o,r,t,n,s,l),alert("Đã cập nhật task mới!"),$("#addtask")[0].reset(),$("#customFileLabel").html(""))},error:function(){alert("Lỗi khi upload!")}}),!1}function buildDemoTask(){$("#select").on("change keypress",function(t){$(".list-group-item").removeClass("status-3").removeClass("status-2").removeClass("status-1").removeClass("status-0"),$(".list-group-item").addClass("status-"+t.target.value),$(".list-group-item .pot").removeClass("pot-3").removeClass("pot-2").removeClass("pot-1").removeClass("pot-0"),$(".list-group-item .pot").addClass("pot-"+t.target.value)}),$("#addtask input, #addtask textarea").each(function(){$(this).on("change keypress",function(t){$("[data-"+$(this).attr("id")+"]").html(t.target.value)})}),$(".timedemo").attr("data-original-title",moment(Date.now()).format("DD/MM/YYYY")+" lúc "+moment(Date.now()).format("HH:mm")),$(".timedemo").html(moment(Date.now()).fromNow())}$(document).ready(function(){__addTask_submitForm(),buildDemoTask(),$("#cru").html(localStorage.getItem("CurrentUser")),$.ajax({url:Global.API_URL+"/user.json",type:"GET",async:!0,dataType:"json",cache:!0,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+localStorage.getItem("Token"))},error:function(t,e,a){},complete:function(t){var e=JSON.parse(t.responseText),a=[];for(var o in e)if(e.hasOwnProperty(o)){var r=e[o],n='<option value="'+o+'">'+r.fullname+" ("+r.username+")</option>";a.push(n)}$("#asuser").html(a).select2({}).on("select2:opening",function(t){App.workID=t.target.value}).on("change",function(t){App.workID=t.target.value})}})});